{"version":3,"sources":["../src/createcomment.js"],"names":["define","$","Ajax","Swal","CreateComment","registerEventListeners","prototype","keypress","event","keycode","keyCode","which","target","currentTarget","saveComment","val","bind","click","closest","children","value","discussdiv","length","showToast","id","data","course","showInvalidDiscussNotification","request","call","methodname","args","post","message","parent","done","addCommentToDiscuss","fail","error","type","Toast","mixin","toast","position","showConfirmButton","timer","timerProgressBar","onOpen","addEventListener","stopTimer","resumeTimer","fire","icon","title","userimg","find","clone","userfullname","attr","append","html","insertBefore"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Create comment js logic.\n *\n * @package    format_timeline\n * @copyright  2020 onwards Willian Mano {@link http://conecti.me}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'format_timeline/sweetalert'], function($, Ajax, Swal) {\n    var CreateComment = function() {\n        this.registerEventListeners();\n    };\n\n    CreateComment.prototype.registerEventListeners = function() {\n        $(\".post-comment-input\").keypress(function(event) {\n            var keycode = (event.keyCode ? event.keyCode : event.which);\n\n            if (keycode === 13) {\n                var target = $(event.currentTarget);\n\n                this.saveComment(target, target.val());\n\n                target.val('');\n            }\n        }.bind(this));\n\n        $(\".post-comment-btn\").click(function(event) {\n            var target = $(event.currentTarget).closest('.input-group').children('.post-comment-input');\n\n            this.saveComment(target, target.val());\n\n            target.val('');\n        }.bind(this));\n    };\n\n    CreateComment.prototype.saveComment = function(target, value) {\n        if (value === '') {\n            return;\n        }\n\n        var discussdiv = target.closest('.discuss');\n        if (discussdiv.length === 0 || discussdiv.length > 1) {\n            this.showToast('error', 'Erro ao tentar localizar a discussão para este comentário.');\n\n            return;\n        }\n\n        var id = discussdiv.data('id');\n        var course = discussdiv.data('course');\n        if (typeof id === undefined || typeof course === undefined) {\n            this.showInvalidDiscussNotification();\n        }\n\n        var request = Ajax.call([{\n            methodname: 'format_timeline_createpost',\n            args: {\n                post: {\n                    course: course,\n                    message: value,\n                    parent: id\n                }\n            }\n        }]);\n\n        request[0].done(function(data) {\n            this.addCommentToDiscuss(discussdiv, data.message);\n        }.bind(this)).fail(function(error) {\n            var message = error.message;\n\n            if (!message) {\n                message = error.error;\n            }\n\n            this.showToast('error', message);\n        }.bind(this));\n    };\n\n    CreateComment.prototype.showToast = function(type, message) {\n        var Toast = Swal.mixin({\n            toast: true,\n            position: 'top-end',\n            showConfirmButton: false,\n            timer: 8000,\n            timerProgressBar: true,\n            onOpen: (toast) => {\n                toast.addEventListener('mouseenter', Swal.stopTimer);\n                toast.addEventListener('mouseleave', Swal.resumeTimer);\n            }\n        });\n\n        Toast.fire({\n            icon: type,\n            title: message\n        });\n    };\n\n    CreateComment.prototype.addCommentToDiscuss = function(discussdiv, value) {\n        var userimg = discussdiv.find('.add-comment .userimg').clone();\n        var userfullname = userimg.attr('alt');\n\n        $(\"<div class='post fadeIn'><div class='userimg'>\" + $('<div/>').append(userimg).html() + \"</div>\" +\n          \"<div class='entry'><div class='entry-content'>\" +\n          \"<p class='name'>\" + userfullname + \"</p>\" +\n          \"<p class='text'>\" + value + \"</p>\" +\n          \"</div></div></div>\").insertBefore(discussdiv.find('.add-comment'));\n    };\n\n    return {\n        'init': function() {\n            return new CreateComment();\n        }\n    };\n});"],"file":"createcomment.min.js"}